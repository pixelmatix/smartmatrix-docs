# SmartMatrix Projects

## Guides on Adafruit Learning System

We published a couple guides showing how to use the SmartMatrix Shield on the Adafruit Learning System.  All the guides can be found on the [Pixelmatix page](https://learn.adafruit.com/users/Pixelmatix) on the Adafruit Learning System.

> ![SmartMatrix Animated GIF Player](photos/Projects/AdafruitGifPlayer.gif)
> [SmartMatrix Animated GIF Player](https://learn.adafruit.com/smartmatrix-animated-gif-player)

> ![SmartMatrix Animated GIF Player](photos/Projects/AdafruitAurora.gif)
> [SmartMatrix Remote Controlled LED Art Display](https://learn.adafruit.com/smartmatrix-remote-controlled-led-art-display)

## SmartMatrix Bundle Accessories

### SmartMatrix Frame Kit

The first batch of paperboard has extra holes due to a miscommunication with the vendor.  It may take a little extra work to find the right holes.  Use the picture with the screws to see which holes to use.  Use the polarizing pins on the panel to guide the paperboard into the right place.

When routing the matrix power cable between the paperboard and the display, be careful of the sharp screws that protrude from the display.  Route the cable to avoid the screws so they do not impale the power cable when the paperboard is added.  You can also remove the screws, or clip them with diagonal cutters to be shorter and less sharp.

The shield rests on top of the paperboard at an angle.  If you want to keep the shield flat for a lower profile, you can cut the paperboard with a knife, then gently bend it down so the front of the shield can sit lower.  

> ![title](photos/SdAssembly/Frame/1-IMG_6320.jpg) 

Start with the Shield plugged (loosely is fine) into the matrix data connector and the power cable routed the way you want it.  Unplug the Shield and feed it at an angle through the hold in the paperboard. 

> ![title](photos/SdAssembly/Frame/2-IMG_6321.jpg) 
> ![title](photos/SdAssembly/Frame/3-IMG_6322.jpg) 

Seat the paperboard on the matrix panel, making sure the polarizing pins on the panel fit through holes in the paperboard, and the four screw holes in the corners are visible through other holes.

> ![title](photos/SdAssembly/Frame/4-IMG_6324.jpg) 

Make sure the cable is routed neatly under the paperboard and isn't kinked or sitting on top of a sharp screw in the panel.  Adjust the cable routing if necessary.  Press down a bit to hold the paperboard in place until you have added a screw in the upper right corner to hold it for you.  

> ![title](photos/SdAssembly/Frame/5-IMG_6326.jpg) 

Tighten each screw until the paperboard is sitting flat against the panel and the top of the screw is flush with the paperboard

> ![title](photos/SdAssembly/Frame/6-IMG_6327.jpg) 

Remove the cover from the adhesive strip

> ![title](photos/SdAssembly/Frame/7-IMG_6329.jpg) 

Insert the shield into the data connector and push the front edge down on the adhesive.  If you cut and bent down the adhesive a bit before adding the shield, the shield should sit fairly flat against the paperboard.

> ![title](photos/SdAssembly/Frame/8-IMG_6332.jpg)

#### Compatible Frames
There are quite a few 8"x8" shadow box frames out there, but only two of them are recommended for use with the SmartMatrix Frame Kit based on fit and quality.

MCS makes a 1" deep frame that gives a pixelated effect when used with the frosted acrylic in the SmartMatrix Frame Kit.  It's available from [Amazon.com](http://www.amazon.com/MCS-Scrapbook-Shadowbox-8-Inch-40393/dp/B004L6G2RE/), and [other online stores](https://www.google.com/shopping/product/8413181197040904862), and may be available at local stores.  It's MCS item number 40393.  Jeff reports some A.C. Moore stores (East Coast) carry this frame.

Michaels makes a 1-1/4" deep frame that gives an abstract effect when used with the frosted acrylic in the SmartMatrix Frame Kit.  It's available from [Michaels.com](http://www.michaels.com/shadowbox-with-signature-mat-black-8x8in/10223090.html) as well as in most of their stores.

#### MCS Frame Installation

Of the two frames, this one is the easiest to install as it doesn't require any modification or tools.

Lift up the tabs on the back of the frame to remove the MDF panel

> ![title](photos/SdAssembly/Frame/MCS/1-IMG_6241.JPG) 

Remove the MDF and paper.  We won't need these anymore.

> ![title](photos/SdAssembly/Frame/MCS/2-IMG_6243.JPG) 

Remove the divider, and carefully remove the glass as it has sharp edges.  We won't need the glass anymore either.

> ![title](photos/SdAssembly/Frame/MCS/3-IMG_6244.JPG) 

Remove the protective film from both sides of the frosted acrylic.  It may be difficult to start peeling the film, you can use the edge of a knife to separate the film from the acrylic at one of the corners to get started.  

> ![title](photos/SdAssembly/Frame/Michaels/09-IMG_6345.JPG) 

Set the acrylic into the frame

> ![title](photos/SdAssembly/Frame/MCS/4-IMG_6245.JPG) 

Hold the acrylic up to some light to look for any dust that will show up when backlit from the LEDs.  Clean off any dust before closing everything back up.

> ![title](photos/SdAssembly/Frame/MCS/5-IMG_6247.JPG) 

Add the divider back to the frame.

> ![title](photos/SdAssembly/Frame/MCS/6-IMG_6248.JPG) 

Drop the display with the paperboard panel onto the divider, and close the tabs to hold everything together.

> ![title](photos/SdAssembly/Frame/MCS/7-IMG_6249.JPG) 

This frame doesn't come with a hanger (it was on the MDF).  You can use attach the included hanger and nails to the frame if you want to mount it on the wall.

#### Michaels Frame Installation

You will need some needle-nose pliers and something thin for prying (a paint scraper for example) for installation of this frame.

Lift up the tabs on the back of the frame to remove the MDF panel

> ![title](photos/SdAssembly/Frame/Michaels/02-IMG_6336.JPG) 

Remove the MDF and paper.  We won't need these anymore.
> ![title](photos/SdAssembly/Frame/Michaels/03-IMG_6337.JPG) 

The divider is made up of four pieces nailed to the sides of the frame.  Insert something thin that can pry each piece from the side of the frame.  It doesn't take much force to separate the pieces.  

> ![title](photos/SdAssembly/Frame/Michaels/04-IMG_6339.JPG) 
> ![title](photos/SdAssembly/Frame/Michaels/05-IMG_6340.JPG) 

Set the pieces aside, we will add them back later.

> ![title](photos/SdAssembly/Frame/Michaels/06-IMG_6341.JPG) 

Now use needle-nose pliers to pull the nails from the sides of the frame.

> ![title](photos/SdAssembly/Frame/Michaels/07-IMG_6342.JPG) 

Carefully remove the glass as it has sharp edges.  We won't need the glass anymore.

> ![title](photos/SdAssembly/Frame/Michaels/08-IMG_6344.JPG) 

Remove the protective film from both sides of the frosted acrylic.  It may be difficult to start peeling the film, you can use the edge of a knife to separate the film from the acrylic at one of the corners to get started.  Set the acrylic into the frame

> ![title](photos/SdAssembly/Frame/Michaels/09-IMG_6345.JPG) 

Hold the acrylic up to some light to look for any dust that will show up when backlit from the LEDs.  Clean off any dust before closing everything back up.

> ![title](photos/SdAssembly/Frame/MCS/5-IMG_6247.JPG) 

Add the four divider pieces back to the frame.

> ![title](photos/SdAssembly/Frame/Michaels/10-IMG_6346.JPG)

Carefully drop the display with the paperboard panel onto the divider so the display panel is between the divider and the paperboard is resting on top, without knocking over any of the divider pieces.  Close the tabs to hold everything together.

> ![title](photos/SdAssembly/Frame/Michaels/11-IMG_6347.JPG)

### IR Remote Kit

The red/black/white leads line up to 3V3/Gnd/Data pins on the IR Receiver.  Use the pictures to make sure the receiver is inserted the right way.

> ![title](photos/SdAssembly/IR/1-IMG_6349.jpg) 

It can be difficult to tell how far the leads are inserted into the connector.  This sensor has the leads covered with a black marker to the depth of the connector, about .19".  When inserted properly, you can't see the black marker anymore.  This can be a good way to tell if the sensor is inserted far enough.

> ![title](photos/SdAssembly/IR/IMG_6417.jpg) 

It's much easier to insert the sensor when the leads are at an angle.  Point the leads so they are facing the all-white wall of the connector, not the side with the silver contacts visible.  Pointed this way, it should only take a little pressure and wiggling of the sensor before it goes in.  The leads will move in noticeably when positioned correctly.  

> ![title](photos/SdAssembly/IR/IMG_6419.jpg) 

It's possible to push the sensor in too far, so the leads are sticking out the other side.  This will work, but is more of a risk for shorting something out or damaging the cable.

> ![title](photos/SdAssembly/IR/IMG_6420.jpg) 

You can trim the leads before sliding into the connector if you want the sensor to be closer to the connector.

> ![title](photos/SdAssembly/IR/3-IMG_6352.jpg) 

You can braid the cable to keep it tidier.  

> ![title](photos/SdAssembly/IR/4-IMG_6353.jpg)

Insert the loose ends into the 3-pin housing in the same Red/Black/White order as the other end of the cable.

> ![title](photos/SdAssembly/IR/5-IMG_6356.jpg)
> ![title](photos/SdAssembly/IR/6-IMG_6357.jpg)

Use the colors to add the IR receiver cable to the correct pins on the SmartMatrix SD Shield.  
(Red = 3V3, Black = GND, White = IR)

> ![title](photos/SdAssembly/IR/IMG_6415.jpg)

The battery compartment can be tricky to open.  Use one fingernail to move the tab inward.  At the same time, use your thumbnail to pull the tray outward.  

> ![title](photos/SdAssembly/IR/7-IMG_6359.jpg) 
> ![title](photos/SdAssembly/IR/8-IMG_6360.jpg) 
> ![title](photos/SdAssembly/IR/9-IMG_6363.jpg)


### Aurora Sketch

This sketch demoed at Maker Faire features a menu system controlled using the IR remote and plays animated GIFs from a SD card.  You can find the sketch and instructions for use here:
https://github.com/pixelmatix/aurora

## Aurora Display (Bay Area Maker Faire 2014)

_This project is captured for reference for customers that bought the Aurora Display Kit at Bay Area Maker Faire 2014.  This display is not being sold any more._

The Aurora Display is a combination of SmartMatrix Shield, and an enclosure with an adjustable diffusion screen that can be separated from the RGB matrix panel. By putting the diffusion screen close to the panel, the screen shows a pixelated effect. By separating the diffusion screen from the panel, the individual pixels lose focus and blur together. The images that can be made with the out of focus panel donâ€™t look like they could be made by such a low resolution display.

> ![Aurora Display](photos/AuroraAssembly/AuroraIsolated.png)  

Design credit for the enclosure goes to Al Linke's Pixel, which is where I got the idea for the dark acrylic in front with diffusion behind, nice-looking screw heads, and standoffs combination for this case.
https://www.kickstarter.com/projects/alinke/pixel-led-art


### Assembly

Tools needed for assembling the Aurora Display enclosure  
    
- Phillips Screwdriver
- Knife or razor blade
- Needlenose Pliers (or 5.5mm hollow-shaft nut driver)
- Cloth - either lint-free or microfiber
- (optional) acrylic cleaner, or mild soap and water
- (optional) 2.5mm hex driver  

> ![Tools](photos/AuroraAssembly/01-Tools.jpg)  

The front screen of the enclosure is made from three layers: transparent gray acrylic for good color contrast, white polypropylene film for diffusion, and clear polycarbonate to hold the polypropylene film in place.  

> ![Layers](photos/AuroraAssembly/02-Layers.jpg)

A couple important things before starting:  
 - Any large dust trapped between the layers will show when light is shined through, so it is important to clear dust off of each layer before assembling.  
 - If the polypropylene film is creased, the crease will be visible, so be careful not to fold the film or use any tools that might pinch it while assembling.

Wipe the exposed side of acrylic with your cloth, and if you have any, use the acrylic cleaner on it.

> ![Dusting acrylic](photos/AuroraAssembly/03-CleanAcrylic.jpg)

The polypropylene film has two parts, a clear film and a while film that are attached at the four holes in the corners.  Peel the clear layer off and discard.

> ![Polypropylene Layers](photos/AuroraAssembly/04-PolyProLayers.jpg)

Wipe any dust off of one side of the while polypropylene film.  

> ![Cleaning Polypropylene](photos/AuroraAssembly/05-PolyProCleaning.jpg)

Add the polypropylene film on top of the acrylic with the two clean sides touching, and dust the other side of the polypropylene film.

> ![Cleaning Polypropylene](photos/AuroraAssembly/06-PolyProCleaning2.jpg)

The polycarbonate has a protective film on at least on one side.  There is usually one side that is very easy to remove (or is missing already), and a second side where it is difficult to find the edge that removes it from the polycarbonate.  The polycarbonate will be crystal clear when the film is removed.  Use the tip of your knife or razor blade outside one of the four holes in the corner to lift the film from just that corner, and keep the rest on for now to protect the surface while assembling.

> ![Polycarbonate Protective Film](photos/AuroraAssembly/07-PolyCarbFilm.jpg)

Put the protective film side down, and wipe any dust from the other side of the polycarbonate.

> ![Polycarbonate Cleaning](photos/AuroraAssembly/08-PolyCarbCleaning.jpg)

Add the polycarbonate to the pile of acrylic, polypropylene, with the film side up, so you have a plastic "sandwich" with protective coatings on the very top and bottom.  Find the corner with the loose polycarbonate protective film.  Insert one socket head cap screw through the acrylic, and the holes in the other plastics, but not through the polycarbonate protective film, so you can easily remove the film later.  Add a hex locknut to it, just loosely tightened with your fingers.

> ![Adding Screw and Nut](photos/AuroraAssembly/09-ScrewAndNut.jpg)

Repeat with the other three holes, but don't worry about the polycarbonate film, it will be separated later.

> ![Four Screws](photos/AuroraAssembly/10-FourNuts.jpg)

Grip the hex locknut with needlenose pliers, or if you have it, a 5.5mm hollow-shaft nut driver.  Tighten with the included 2.5mm hex key, or if you have it, a 2.5mm hex driver.

> ![Tightening Screw and Nut](photos/AuroraAssembly/11-TighteningScrewAndNut.jpg)

Once the nut and screw tighten around the plastic, unscrew it a bit so it is just loose enough to spin easily.  Repeat with the other three holes.

If you find the polycarbonate has bowed a bit and isn't lying flat along one of the edges, loosen the two screws on that edge and push flat with your fingers, then tighten again.

Use your knife to separate the paper backing from the two acrylic pieces that make up the back of the frame.

> ![Removing Paper Backing](photos/AuroraAssembly/13-BackingPaper.jpg)

Pull on the paper to remove it completely.

> ![Removing Paper Backing](photos/AuroraAssembly/14-BackingPaper2.jpg)

Add the back pieces on top of your display as shown in the picture.  The white text printed on the back of the display is readable when the display is facing up, and the arrows on the back of the display point up and to the right.  The back pieces of the enclosure are unique:  the upper back piece has two mounting/hanging holes on it, and the lower back piece has one mounting/hanging hole and a slit.

> ![Back Enclosure](photos/AuroraAssembly/15-BackScrews.jpg)

Add two flathead screws to each back piece and use your phillips screwdriver to hand tighten.  Do not overtighten by using an electric screwdriver as this may cause the acrylic to crack.  There are eight mounting holes in the display but only four are used with the enclosure.  The others can be used to attach the display to another object.

Add a standoff and flathead screw to the four corners just loosely finger-tightening for now.  Repeat with the other three corners.

> ![Standoffs](photos/AuroraAssembly/16-FingerTighteningStandoffs.jpg)

Pull on the loose corner of the polycarbonate protective film toward one of the adjacent corners, and pull the film off from around that corner.  Repeat until the film is completely removed and discard.

> ![Removing Polycarbonate Film](photos/AuroraAssembly/17-RemovingCoating.jpg)

Add the front panel on top of the standoffs.  Tighten the screw in each corner about 10 half-turns with the allen key.  

> ![Tightening Front Panel](photos/AuroraAssembly/19-TighteningFrontPanel.jpg)

Flip the display over and tighten the screws in the corner with the screwdriver, again being careful not to overtighten with an electric screwdriver to avoid cracking the acrylic.

> ![Tightening Standoffs](photos/AuroraAssembly/20-TighteningStandoffs.jpg)

Use a fingernail if you can, or carefully use a knife, to separate the paper backing from the front of the display but avoid scratching as the front panel is visible.

> ![Removing Front Paper](photos/AuroraAssembly/22-RemovingFrontPaper.jpg)

You may have to pull some bits off the screws in the corners.

> ![Removing Front Paper](photos/AuroraAssembly/23-RemovingFrontPaper2.jpg)

You can now add the SmartMatrix Shield to your display and adjust the height of the front panel to get the desired effect for the content you are displaying.

## Fadecandy Support

### Getting Started

Fadecandy is an open source project by Micah Elizabeth Scott to "make LED art easier, tastier, and more creative".  It combines server software running on a computer with firmware running on specialized hardware to drive WS2812 LED strips and matrix displays with smooth color transitions.  

Take a look at the first three links from the [Fadecandy Readme](https://github.com/scanlime/fadecandy/blob/master/README.md) to get a good overview of what Fadecandy is all about:

* [Video Introduction](https://vimeo.com/79935649)
* [Tutorial: LED Art with Fadecandy](http://learn.adafruit.com/led-art-with-fadecandy)
* [Presentation slides: Easier and Tastier LED Art with Fadecandy](http://imgur.com/a/TaJBK)

To make Fadecandy compatible with the SmartMatrix display required major Fadecandy firmware changes that combine pieces of the Fadecandy firmware with the SmartMatrix Library, as well as some minor Fadecandy server changes.  The end result is a new set of firmware and server binaries published on GitHub, along with the server source (firmware source coming soon).  At the moment there's only one example Fadecandy application for the SmartMatrix 32x32 display, but other examples can be adapted with just a few changes.


### Installation

*Note for any Teensy 3.0 or 16x32 matrix display users - the SmartMatrix Fadecandy firmware only runs on a Teensy 3.1, any only supports a 32x32 display right now*

Let's run an example application, similar to what Pixelmatix was showing at Maker Faire.  It consists of:

- A Processing application that generates graphics which are then turned into a 32x32 pixel frame and sent to...
- The Fadecandy server, which has been slightly modified from the original to allow for driving up to 1024 (32x32) LEDs instead of the original maximum of 512.  The server receives video data from a network socket and translates it into messages sent over a USB connection to...
- The Fadecandy firmware, running on a Teensy 3.1 attached to a SmartMatrix Shield.  The firmware waits to receive a full frame of graphics over USB, then converts the data into the appropriate bits to send to the SmartMatrix display.

It will take some work the first time to set everything up.  First, we need to get the Fadecandy project with modifications for SmartMatrix.  It is available on GitHub here, and you can either download the ZIP file from the link on the right hand side, or if you are using Git, you can clone the project.

[GitHub - Pixelmatix/Fadecandy](https://github.com/pixelmatix/fadecandy)

If you downloaded the ZIP, extract the contents to a folder where you plan to store the project.

If you're using git, run  
`git clone https://github.com/pixelmatix/fadecandy`  
from the commandline.

First we need a program to generate animations to send to the display.  Fadecandy comes with a number of examples for Processing, which is a program that provides an easy way for artists to get into graphics programming.  Download the latest version of Processing from [processing.org](http://processing.org/download/), extract the program and run it.  Open up the 32x32 pixel example inside `fadecandy/examples/processing/grid32x32z_clouds`.  Run the example by pressing the play button.  You should see animated clouds inside the java application that just started.  Let's get those graphics moving toward the display.

Next, start the Fadecandy server by running the precompiled server binary located in the /bin directory.  There is a binary for Windows called fc-server.exe, and one for Mac called fc-server-osx.  You can double click on the appropriate one for your OS to run it, or open a terminal or command prompt window and run it from there.  If you're running on Linux or specifically the Raspbery Pi, you need to compile the server from source in the /server directory (see the Linux section below).

Running the server should open up a terminal or command prompt window with a message saying `NOTICE: Server listening on 127.0.0.1:7890`.  Open up that address in a web browser to see a Fadecandy Server status page, that should look like this:

> ![Fadecandy Server - No Devices Connected](photos/Fadecandy/FadecandyServer-Noconnect.png)

You should also see another line that says `NOTICE: New Open Pixel Control connection` refering to the connection from the clouds Processing application that is running.  With the webpage up and server running, let's move on to the next step.

Next, we need a tool to load the Fadecandy firmware onto the Teensy 3.1.  If you've already loaded some firmware onto your Teensy using the Arudino IDE, you're ahead of the game and can now skip ahead a few paragraphs in the instructions to use Teensy Loader to copy the fc-firmware-sm-v107.hex file to the Teensy.

Download the Arduino IDE and Teensyduino Addon.  Install the Arduino IDE first, then the Teensyduino Addon.

* [Arduino IDE](http://arduino.cc/en/main/software) - only version 1.0.5
* [Teensyduino](http://www.pjrc.com/teensy/td_download.html) - only version 1.18
* Teensyduino needs to be installed as an administrator on Windows to install USB driver properly
* You don't need to add any additional Arduino libraries when asked during Teensyduino installation to enable Fadecandy support. 

Start the Teensy Loader application.  If you've already uploaded a sketch to your Teensy, then just do that again to bring up the Teensy Loader.  Or, continue on to find where the Teensy Loader application is stored on your computer.

On a Mac, find Arduino.app in your Applications folder, and right click on the icon to choose "Show Package Contents".  Navigate into the application structure to find the Teensy Loader application.  It is buried inside the application at
`Arduino.app/Contents/Resources/Java/hardware/tools/teensy.app`
You can make an alias to make this program easier to find in the future.

On the PC, find the directory where Arduino was installed under "Program Files", then under /hardware/tools/ run teensy.exe.  You can make a shortcut to make this program easier to find in the future.

OK, now that we know how to run the Teensy Loader program, we just need to copy the Fadecandy firmware to the Teensy.  Either use the File menu and Open HEX File to open firmware-sm-v107.hex in the `/fadecandy/bin directory`, or just drag `firmware-sm-v107.hex` onto the Teensy Loader window to queue it for loading.  Now connect your Teensy 3.1 through the USB cable to your computer, and connect power to the SmartMatrix shield.  Press the button on the Teensy 3.1 to download new firmware.  You can watch the progress on the Teensy Loader application to make sure it was loaded.  When complete, the cloud animation should be showing on the SmartMatrix display, and look at the Fadecandy server status page in your webbrowser, and you should now see a new device connected.

> ![Teensy Loader](photos/Fadecandy/TeensyLoader.png)

That was a lot of steps, but now you should be able to see smoothly changing LEDs on your SmartMatrix display.  Next time you want to run Fadecandy it will be easier.  You shouldn't need to load the firmware, unless you replaced it with other firmware in the meantime.  The server starts with just double clicking the executable, and it's easy to load and play a processing example.

### Linux and Raspberry Pi

Fadecandy doesn't come with a precompiled server binary for Linux.  To compile, first clone the github repo, then use make tools to compile:

> git clone https://github.com/pixelmatix/fadecandy
> 
> make submodules 
> 
> make all

GitHub user pup05 contributed a compiled version for Raspberry Pi: `fcserver-rpi` in the `/bin` folder

### Examples

You can play with some more Processing examples by replacing any calls to `opc.ledGrid*()` with a single `opc.ledGrid()` call like in the `grid32x32z_clouds` example.  Most will work with just this one line change, and there will be more examples added to the GitHub repo soon.

